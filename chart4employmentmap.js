$(function () {

    // Prepare data
    // for OECD link on iso3
	var year = 2019;
	var start = 2000;
	var finish = 2019;
	/*var seriesPath ='chart4employment.json'	// this will be changed later under program control*/
 
 	function prepMapData(year){
		// Prepare data
   		 var allData = [
			 [{iso3: "AUS", data: [64.4,64,64.5,64.9,66,67.4,67.9,68.6,69.8,68.3,69.2,70.5,70,69.7,69.6,69.9,70.3,70.8,72,72.3]}],
			 [{iso3: "AUT", data: [66.8,66.6,65.9,67.7,61.6,62.2,63.4,65,65.1,64.7,66.3,66.7,65.6,65.2,64.9,64.7,64.6,65.6,68,68.9]}],
			 [{iso3: "BEL", data: [49.7,47.6,48.5,47.1,50.1,50.2,50.1,50.9,54,52.2,53,52.6,52,52.7,52.8,53.3,54.1,56.5,58.3,58.7]}],
			 [{iso3: "CAN", data: [,,,,,,,,70.8,68.5,68.8,69,70.1,70.6,70.1,70.9,71.7,72.8,72.3,73.2]}],
			 [{iso3: "CZE", data: [64.9,65,58.8,58.8,56.9,61.4,60.5,67.3,66.4,65.8,68.1,67.8,67.3,69.8,71.8,71.1,73.5,77.5,79.4,79.2]}],
			 [{iso3: "DNK", data: [60.3,61.6,62.2,58,59.4,63.4,64.2,62.5,66.1,67.9,63.6,61.7,61.1,62.9,63.9,63.6,66.8,65,66.4,65.7]}],
			 [{iso3: "FIN", data: [45.2,57.4,60.6,58.6,55.7,55.4,59.8,63.5,65.5,64.4,64.4,62.1,63.8,63.4,60.7,59.3,59,60.3,62.2,64.2]}],
			 [{iso3: "FRA", data: [52.2,53.5,53,57.1,58.3,57.4,57.2,58.7,59.5,57.3,57.9,57.3,57.6,56.9,56.4,55.5,55.3,56.6,58.5,58.9]}],
			 [{iso3: "DEU", data: [59.4,60.8,60.2,58.9,57.8,56.4,58.2,60.2,62.9,62.1,65,66.9,68,68.3,68.4,68.4,68,68.1,69.5,70.8]}],
			 [{iso3: "GRC", data: [60.3,61.1,64.7,66.3,64.1,66,66.8,66.6,67.5,66,64,58.4,49.6,47.6,50.3,52.2,53.7,52.8,52.8,53.3]}],
			 [{iso3: "HUN", data: [58.5,54.7,56.9,62.4,61.4,62.6,60.7,64.5,64.7,65.5,65.5,62.1,66.6,67.8,70.4,71.1,73.8,73.7,71.7,77.4]}],
			 [{iso3: "ISL", data: [86.6,87.9,86.1,87.2,80.1,81.8,84,85.5,81.2,77,74.7,75.8,79,79.9,81.9,80.7,86.6,88.1,82.5,82.4]}],
			 [{iso3: "IRL", data: [64.9,66.9,65.4,63.1,64,68.7,71.1,73.1,71.3,62.2,59.3,59,58.8,60.5,61.2,62.6,65.1,69,70.7,71.5]}],
			 [{iso3: "ITA", data: [60.9,59.2,65.3,67.2,63.4,63,65.1,65.9,65.1,62.8,61.9,61.5,60,58.1,58.4,58.6,59.2,60,60.9,61.4]}],
			 [{iso3: "LUX", data: [66.5,69.4,69.3,67.9,67.2,69.2,68.9,71.1,69,69,70.4,69.8,71.3,71.5,72,69.5,69,70.8,71.4,72]}],
			 [{iso3: "MEX", data: [,,,,,,55.6,56.2,54.4,51.8,48.2,49.4,53,53.6,54,53.4,51.8,55,52.2,51.8,53.2]}],
			 [{iso3: "NLD", data: [59.9,63.1,63.2,61,60,61.1,59.4,62.4,65.7,64.5,64.3,64,63.1,61.2,61.4,61.1,62,63,64.9,66.5]}],
			 [{iso3: "NZL", data: [,,64.3,64.4,64.7,66.2,67.7,69.5,70.4,70,68.8,68.3,70.3,70.5,71.5,71.9,73.5,75,77.2,77.8]}],
			 [{iso3: "NOR", data: [69,70.3,69,67.3,66.4,63.3,66.3,69.9,74,68.7,69.4,68.7,70.9,70.3,69.8,68.6,69.2,69.3,69.7,69.8]}],
			 [{iso3: "POL", data: [55.1,53.7,51.7,51.4,27.2,29.9,35.4,36.8,43.5,45.5,50.4,55.2,61.9,59.2,63,60.7,62.6,69.9,73,75]}],
			 [{iso3: "PRT", data: [70.2,71.3,74.5,72.7,70.1,72.5,71.8,73.1,74,69.8,69.1,68.7,66.4,62.6,66.6,68,70.4,74.3,75.1,76.3]}],
			 [{iso3: "SVK", data: [56.3,56.7,56.5,54.5,52.4,51.4,55.2,66,68.1,60.6,56.5,59.4,63.7,66.4,66.1,58.4,64.7,69.8,73.3,78.7]}],
			 [{iso3: "ESP", data: [60.1,64.1,65.3,65.5,66.6,69.3,69.7,70.3,65.8,57.4,55.3,55.1,52.1,50.7,52.3,55.2,57.6,59.6,61.6,62.7]}],
			 [{iso3: "SWE", data: [49.8,61.8,62.1,62.3,61.3,61,61.6,63.1,64,62.1,61.2,62.5,62.8,62.9,63.5,64.1,64.9,66.3,66.7,65.8]}],
			 [{iso3: "CHE", data: [78.3,75.7,78.8,72.6,72.3,71.7,72.7,73.7,75.5,75.7,74.6,75.7,76.1,75.9,76.3,76.5,76.6,75.8,76.6,77.1]}],
			 [{iso3: "TUR", data: [,,,,,,,,48.8,47.2,49.5,49.7,46.1,46.6,46.3,44.4,43.9,46.2,47.4,44.2]}],
			 [{iso3: "GBR", data: [61.4,62.6,63,62.8,63.4,63.7,66.2,66.4,67.9,66.6,66.8,66.7,66.5,67.5,69.4,70.5,71.9,72.5,73.7,74.7]}],
			 [{iso3: "USA", data: [70.5,69.8,68.5,68.5,69.7,70.5,71.6,71.8,70.8,67.7,67.6,67.5,67.7,68.4,69.1,69.2,70,71,71.6,72.2]}],
			 [{iso3: "EST", data: [63,62.5,63.2,63.5,66.6,68.9,71.8,74.2,74.8,67.8,59.1,63.6,67.2,68.4,68,70.2,70.8,71.7,70.1,74.6]}],
			 [{iso3: "ISR", data: [ ,,,,,,,,,,,,74.8,75.8,77.4,78,78.6,78.9,78.8,79.1]}],
			 
			 [{iso3: "SVN", data: [64,67.9,66.3,64,64.8,67.2,66.8,67.9,68.4,66.1,65.3,61.9,63.9,60.5,58.2,61.3,62.4,66.3,67,68]}],
			
			 [{iso3: "OECD", data: [,61,62,62,61,63,64,66,66,63,63,64,64,64 , , , , , , , ]}]
			
			];

		var selectedData = [];
		// OECD series runs from 2000 =>

		for (var i=0; i<allData.length; i++){
			// need to generate: {"iso-a3": "xxx", "value": nnnnn}
			selectedData.push({"iso-a3":allData[i][0].iso3, "value":allData[i][0].data[year-2000]});
			//console.log({"iso-a3":allData[i][0].iso3, "value":allData[i][0].data[year-2000]});
		};

		return selectedData;
	};

 

	function drawMap(year, selectedData){
		// Initiate the chart
		$('#displayarea2').highcharts('Map', {
           

			title: {
				text: 'Employment across OECD countries '+year
			},

			subtitle: {
				text: 'Source map: <a href="https://code.highcharts.com/mapdata/custom/world-robinson.js">World, Robinson projection, medium resolution</a>'
			},

			mapNavigation: {
				enabled: true,
				buttonOptions: {
					verticalAlign: 'bottom'
				}
			},

			colorAxis: {
				min:50,
				max:90,
				minColor: '#E6E6FF',
				maxColor: '#3333FF',
			},

			series: [{
               
				data: selectedData,
				mapData: Highcharts.maps['custom/world-robinson'],
				joinBy: 'iso-a3',
				name: 'Employment % '+year,
				states: {
					hover: {
						color: 'orange'
					}
				},
				dataLabels: {
					enabled: false,
					format: '{point.name}'
				}
			}]
		});
	};
	
	var selectedData = prepMapData(year);
	drawMap(year, selectedData);
});

